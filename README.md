# Домашнее задание по теме "Асинхронность"
## Отчет по продажам
Вы разрабатываете онлайн веб-приложение для генерации отчетов от сети продаж. Владельцы торговой сети (конечные пользователи системы) хотят оперативно получать отчеты о том как идут дела на их точках продаж, какая выручка, какие товары проданы и т.д. Системы внутри торговых точек (тоже конечные пользователи системы) должны используя ваш сервис отчитываться о совершенных продажах товаров чтобы централизованно происходил сбор таких данных. Продажи совершаются часто по этому имеет смысл заложить в сервис способность справляться с большими нагрузками.

## Требования

  - реализуйте асинхронное веб приложение которое
    - обрабатывает GET-запрос на получение всех товарных позиций
    - обрабатывает GET-запрос на получение всех магазинов
    - обрабатывает POST-запрос с json-телом для сохранения данных о произведенной продаже (id товара + id магазина)
    - обрабатывает GET-запрос на получение данных по топ 10 самых доходных магазинов за месяц (id + адрес + суммарная выручка)
    - обрабатывает GET-запрос на получение данных по топ 10 самых продаваемых товаров (id + наименование + количество проданных товаров)
    - никакие лишние эндпоинты реализовывать не требуется
  - напишите readme.md с кратким описанием эндпоинтов и инструкцией запуска
  - используйте requirements.txt для указания сторонних зависимостей и их версий
  - используйте postgres или sqlite в качестве базы.
  - используйте асинхронный веб-фреймворк на ваш выбор и асинхронный драйвер подключения к бд на ваш выбор.
  - в качестве ориентира модели данных можно(а можно и не) использовать приведенную ниже dbml схему (визуализировать ее можно инструментом dbdiagram.io). однако это не     обязательно, можно разработать собственное целевое понимание модели данных.
  
  ## Решение
  - реализовано асинхронное веб приложение которое:
    - обрабатывает GET-запрос на получение всех товарных позиций /items/
    ```
    HTTP/1.1 200 OK
    date: Fri, 23 Dec 2022 10:07:21 GMT
    server: uvicorn
    content-length: 191
    content-type: application/json
      {
        "id": 1,
        "name": "Iphone 14",
        "price": 111111.11
      }
    ```
    - обрабатывает GET-запрос на получение всех магазинов /stores/
    ```
    HTTP/1.1 200 OK
    date: Fri, 23 Dec 2022 10:05:30 GMT
    server: uvicorn
    content-length: 194
    content-type: application/json
      {
        "id": 1,
        "address": "ул. Мира д. 150"
      }
    ```
    - обрабатывает GET-запрос на получение всех продаж /sales/
    ```
    HTTP/1.1 200 OK
    date: Fri, 23 Dec 2022 10:09:00 GMT
    server: uvicorn
    content-length: 676
    content-type: application/json
      {
        "id": 1,
        "sale_time": "2022-12-23T14:05:45.006951",
        "item_id": 1,
        "store_id": 1
      }
    ```
    - обрабатывает POST-запрос с json-телом для сохранения данных о произведенной продаже (id товара + id магазина) /sales/
    ```
    HTTP/1.1 200 OK
    date: Fri, 23 Dec 2022 10:06:09 GMT
    server: uvicorn
    content-length: 74
    content-type: application/json
    {
      "item_id": 3,
      "store_id": 2,
      "id": 9,
      "sale_time": "2022-12-23T14:06:09.925000"
    }
    ```
    - обрабатывает GET-запрос на получение данных по топ 10 самых доходных магазинов за месяц (id + адрес + суммарная выручка) /items/top/
    ```
    HTTP/1.1 200 OK
    date: Fri, 23 Dec 2022 10:26:30 GMT
    server: uvicorn
    content-length: 122
    content-type: application/json
      {
        "id": 1,
        "address": "ул. Мира д. 150",
        "income": 655555.53
      }
    ```
    - обрабатывает GET-запрос на получение данных по топ 10 самых продаваемых товаров (id + наименование + количество проданных товаров) /stores/top/
    ```
    HTTP/1.1 200 OK
    date: Fri, 23 Dec 2022 10:25:05 GMT
    server: uvicorn
    content-length: 136
    content-type: application/json
      {
        "id": 1,
        "name": "Iphone 14",
        "sales_amount": 5
      }
    ```
    
  ## Дополнительно
  Зависимости в файле **requirements.txt**, примеры HTTP запросов в файле **requests.http**.

  База данных используется PostgreSQL со следующими настройками:
  ```
    DB_USER = "postgres"
    DB_NAME = "shop"
    DB_PASSWORD = "admin"
    DB_HOST = "127.0.0.1"
  ```
  и при каждом запуске выполняется удаление всех таблиц в БД и их пересоздание заполнение таблиц начальными данными запуском файла **add_date_to_db**.

    ```
    @app.on_event("startup")
    async def startup():
        # Drop and crate all tables in db 
        await init_models()
        # add new data to db
        add_date_to_db.add_date()
        print("Done")
    ``` 
  После создания таблиц и наполнения их данными эти строки можно закоментировать, для сохранения данных.

  Добавлен **валидатор** для проверки данных переданных в POST запросе и возврат требуемового кода ошибки **400**.
  
  Запуск осуществляется как стандартный скрипт или через команду: **uvicorn main:app --reload**
  
  Критика и пожелания приветствуются. :grinning:
